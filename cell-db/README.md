

### 分库分表规则

#### 不同的 hash 方法
方式一：发送者 uid 尾号 hash

点评：

优点是简单、易懂

缺点是容易出现少数极其活跃用户消息hash到同一个库/表，导致数据倾斜的问题

方式二：发送者 uid 及接受者(peer) uid 相加后，用尾号进行 hash

点评：

能在一定程度上避免部分活跃用户导致的数据倾斜问题

但是，活跃用户多会相互发消息，其实另一种维度的数据倾斜依旧存在。

方式三：rand 函数进行 hash

点评：

由于在seed一样的情况下，使用rand 函数得到的值总是一样的。这种hash方法相较于简单的uid hash能够使活跃用户分布更为随机。


**总结**
其实使用哪种hash算法，取决于数据倾斜的程度。没有哪种hash算法一定比另一种好。选择哪种hash，最好是基于数据统计的基础上，结合自己的业务模型和用户习惯，再做定夺。


#### messageId 生成规则

#### conversationId 生成规则


## 关键流程

### 消息

#### 发送消息

#### 未读消息

#### 历史消息

#### 撤回消息

### 会话

#### 创建会话

#### 会话列表